<script setup lang="ts">
import { onMounted, ref, onBeforeUnmount } from "vue"

const PALETTE = {
    a: [252, 202, 53],
    b: [99, 151, 97],
    c: [102, 169, 208],
    d: [87, 73, 101],
    e: [75, 29, 76],
    f: [231, 149, 161],
    g: [251, 209, 216],
    h: [255, 255, 255],
    i: [169, 163, 189],
    j: [140, 201, 240],
    k: [75, 23, 70],
    l: [251, 137, 154],
    m: [139, 83, 92],
    n: [251, 183, 145],
    o: [68, 136, 208],
    p: [253, 240, 197],
    q: [179, 0, 34],
    r: [248, 36, 53],
    s: [239, 134, 27],
} as const
const canvasRef = ref<HTMLCanvasElement | null>(null)
const ani = ref(NaN)
const frames: (() => void)[] = []

onMounted(() => {
    if (!canvasRef.value) return
    const ctx = canvasRef.value.getContext("2d")
    if (!ctx) return
    ctx.fillStyle = `rgb(${PALETTE.j})`
    ctx.fillRect(0, 0, 48, 40)
    ctx.fillStyle = `rgb(${PALETTE.i})`
    ctx.fillRect(0, 40, 48, 48)
    const canvas = ctx.getImageData(0, 0, 48, 48)
    const flip = () => ctx.putImageData(canvas, 0, 0)
    const draw = (
        color: keyof typeof PALETTE,
        points: (number | undefined)[]
    ) => {
        let last = -1,
            p: number | undefined
        for (p of points) {
            p = p || last + 1
            ;[
                canvas.data[p * 4],
                canvas.data[p * 4 + 1],
                canvas.data[p * 4 + 2],
            ] = PALETTE[color]
            last = p
        }
    }
    // prettier-ignore
    const init = () => {
        draw("k", [1462])
        draw("l", [1318,,1327,,1370,,,,1418,,,,])
        draw("m", [1271,,,1276,,,,1415,1467,,1471,1514,1561])
        draw("n", [1129,1177,1181,1223,1231,1469,,1516,1605,1651,,1799,1848,1850,1896,1899,1947])
        draw("o", [1028,,1077,1091,1093,1095,1141,,1187,,,1235,1606,,1614,1653,,1656,,1666,1700,,1715,1748,1757,,1806,1854,,])
        draw("p", [1081,1085,1224,,,,,,,1274,,1320,,,,,,,1367,,,1374,,1416,,1422,,1603,,1846,,1849,1894,,1897,,1942,,1945,,1990,1993,,])
        draw("q", [848,,1458,,,,1508,,,,1662,1709,,])
        draw("r", [700,,747,,,795,,,,802,,,,,843,,850,,,,,898,,,,,948,,,997,,1046,1238,1286,1334,,1382,,1430,,1457,1506,,1512,,1554,,,,,,,1658,,,,1708])
        draw("s", [897,947,996,1044,,1133,1137,1179,1185,1232,,1236,,1280,1283,,,1331,,,1379,,,1427,,,1464,,,1475,,1522,,,1570,,1608,1618,,1667,1860])
        draw("a", [890,,,,936,,,,,,,,,,,983,,,,,,,,,,,,,1030,,,,,,,,,,,,,,1078,,,1082,,,1086,,,,,1126,,,1130,,,1134,,,1138,1174,,,1178,1180,1182,,,1186,1234,1281,,1329,,1376,,,1424,,,1463,1472,,,1520,,1572,1616,,1620,1655,1664,,1668,1713,1716,,1764,,1908,,,1958])
        draw("b", [1627,,,,,1670,,1674,,,,,,1696,,,1719,,,,,,,,,,,,,1744,,,1768,,,,,,,,,,,,,1786,1789,1791,,,,1816,,,,,,,,,,,,,1833,,1837,,,,,,,,1864,,,,,,,,,1877,,1881,,1884,,,,,,,,,])
        draw("c", [814,,861,,,908,,,,956,,,,1003,,,,,1049,,,,,,,1097,,,,,,,1144,,,,,,,,1191,,,,,,,,,1240,,,,,,,,1288,,,,,,,,1337,,,,,,,1385,,,,,,,1433,,,,,,,1481,,,,,,,,1526,,,,,,,,,,,1543,1574,,,,,,,,,,,,1589,,,1622,,,,,1632,,1637,,,1672,,1680,,1685,,,1691,,1733,,,1739,,1781,,,1787,,1829,,,1835,,1879,1883])
        draw("d", [1905,,,1944,1948,,1952,,,,,,1991,,1995,2002,2004,,,2039,,,,2050,2052,,,2090,2094,2098,,,,,2131,,2138,2141,,2146,,,,,2181,,2185,,2188,,,,,,,,,])
        draw("e", [651,,,699,702,746,750,754,,,,,,794,799,,,807,842,855,888,,903,934,,951,979,,,,999,1027,1047,,1076,1096,1125,1143,1173,1190,1221,,1239,1287,1336,1366,1384,1408,,,,,,,1432,1456,1477,,,,1505,1525,1553,1573,1602,1621,1650,1669,1699,1702,1718,1747,1749,1766,,1795,,1815,1845,1863,1893,1911,1941,1959,1971,,,,1988,2007,2018,2023,2035,2055,2065,,2070,,2083,2103,2115,,,,2130,2151,2180,2197,,2229,2231,,,2236,,,2242,,,])
        draw("f", [0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,48,,,,,,,,,,,,,,,,,,,69,,,,,,,,,,,96,,,,,,,,,,107,,,,,,114,118,,,,,,,144,,,,,,155,,,,,,,,,,,,,,,,,192,,,,,,,,,,,,,,,,,,,,,,216,,240,,,,,,,,,,,,,,,,,,,,289,,,,,,,,,,,,,338,,,480,,,,528,,,,,,576,,,,,,,,624,,,,,,,,,,673,,,,,,,723,727,,1915,,1924,1930,1932,1936,1938,1967,,,1975,,1981,1985,,2009,2028,,,2059,2075,2104,2111,,2114,2125,2164,2171,2199,,2204,2213,,,2224,,2230,2234,2245,,2249,2253,,2260,2274,,2280,2287,2291,2299])
        draw("g", [34,67,,80,,106,113,125,,150,,,,172,214,,218,,260,,264,,288,302,,,,,341,,,,,,,,672,680,722,724,,,1873,,,,1912,,,1917,,,,,,,1926,,,,1931,1933,1937,1939,,1960,,1982,,2008,2011,,,,,,,2024,2031,2056,,2060,2062,,2073,,2076,,2120,,2123,,2155,,,,2163,2170,2177,,,2205,2207,2226,2235,2239,,,2250,,2256,,2259,2268,,2272,,2281,,,,2286,2290])
        draw("h", [684,,734,,760,,809,,845,,,894,,,1515,1517,,1563,,1568,,1611,1750,1752,1754,1798,1800,,,,1808,1812,,,1851,,1857,,,1862,1900,,,,,1984,2021,2049,2061,2086,2093,2097,2122,2140,2167,,,2206,2252,2258,2271,2285])
        flip()
    }
    // prettier-ignore
    {
        frames.push(() => {
            draw("f", [483,534,584])
            draw("h", [682,,708,,1455,1504,1751,1753,1755])
            draw("j", [684,,734,,760,,809,,1754])
            draw("e", [1843,1892,1894,,])
            draw("n", [1847])
            draw("p", [1796,,,,1844,,])
            draw("d", [1942,,])
            draw("i", [1990,2039])
            flip()
        })
        frames.push(() => {
            draw("g", [35,127,198,,])
            draw("f", [80,125,150,,214,262,302,585,634])
            draw("j", [338,682,,1455,1504])
            draw("h", [705,,,1452,,,])
            flip()
        })
        frames.push(() => {
            draw("h", [654,,703,,1451,1497,,,1630,1754,1798])
            draw("j", [585,706,,,,754,1453,,1751,1753,1755,1797])
            draw("f", [680])
            draw("g", [681])
            draw("e", [802,1796,1845])
            draw("n", [1799])
            draw("b", [1843,,1892])
            draw("p", [1847,1894,,1942,,1990])
            draw("d", [2038,,])
            flip()
        })
        frames.push(() => {
            draw("j", [35,127,262,655,703,,,746,1408,,,,,,,1451,,1499,1616,1664,1713])
            draw("g", [80,125,150,,214,302,673,723,727])
            draw("f", [198,,338])
            draw("h", [650,,697,,1496,1570,1675,,1799])
            draw("e", [654,747,1385,1415,1430,1433,1457,,,,,1481,1504,1510,1601,1698,1844])
            draw("r", [1384,1432,1505,1602,,,,,,])
            draw("c", [1478])
            draw("q", [1506,,1556,,,,])
            draw("a", [1511,,1522,1618,1666,1714])
            draw("s", [1513])
            draw("o", [1520,1568])
            draw("b", [1630])
            draw("p", [1651,,1991])
            draw("n", [1653,1699,,])
            draw("d", [1990])
            flip()
        })
        frames.push(() => {
            draw("j", [483,534,584,634,650,,681,698,1496,,,1665,1714])
            draw("f", [673,723,727])
            draw("g", [680])
            draw("h", [696,743,,1444,,,1493,,,1522,1672,,])
            draw("a", [1570,1619,1667])
            draw("b", [1675,,])
            draw("p", [1896,1944,1992])
            draw("n", [1900])
            draw("d", [1947,1994])
            flip()
        })
        frames.push(() => {
            draw("f", [483,534,584,634])
            draw("j", [696,,743,,1445,,1493,,,])
            draw("h", [788,,,,1393,,1442,,1622,1755,1804,1900])
            draw("p", [1370,,,,1418,1800,,,1848,1850])
            draw("s", [1512])
            draw("c", [1672,,])
            draw("m", [1799,1847])
            draw("p", [1851])
            draw("n", [1895,1898,1943,,])
            draw("d", [1899,1945,,1992,,])
            flip()
        })
        frames.push(() => {
            draw("g", [35,127,198,,])
            draw("f", [80,125,150,,214,262,302])
            draw("j", [338,790,,1393,,1442,,,1504,1601])
            draw("h", [786,,835,,1344])
            draw("e", [1408,,,,,,,1505,1602,1699])
            draw("m", [1415])
            draw("p", [1419,1421,1603,,])
            draw("r", [1457,1506,,1512,,1556,,,,])
            draw("q", [1458,,,,1510,,])
            draw("n", [1605,1651,,])
            draw("o", [1606,,1653,1700])
            draw("c", [1622,1698,1844])
            flip()
        })
        frames.push(() => {
            draw("k", [651,746,1384,1478])
            draw("j", [654,789,835,,1344,1755,1804])
            draw("f", [680])
            draw("g", [681])
            draw("h", [737,,813,,1570,1799,,,,1851])
            draw("r", [747,1430])
            draw("c", [1385])
            draw("l", [1418,,1421])
            draw("a", [1522,1665,1714])
            draw("s", [1619,1667])
            draw("p", [1847,1895,1898,1943,,,,1992,,])
            draw("n", [1848,1850,1899,,])
            flip()
        })
        frames.push(() => {
            draw("j", [35,127,262,534,722,737,,786,,,813,1714])
            draw("g", [80,125,150,,214,302,673,723,727])
            draw("f", [198,,338])
            draw("h", [734,,,783,,,859,,1568,1900])
            draw("e", [754,1432])
            draw("r", [802])
            draw("c", [814,1433,1481])
            draw("l", [1370,,,,])
            draw("a", [1520,1616,1664])
            draw("s", [1522,1570,1618])
            draw("o", [1666])
            draw("n", [1896,1947])
            draw("d", [1944,1992])
            draw("p", [1994])
            flip()
        })
        frames.unshift(() => {
            draw("j", [584,634,681,736,783,,,859,,])
            draw("f", [673,723,727])
            draw("g", [680,722])
            draw("h", [684,,760,,809,,])
            draw("a", [1713])
            draw("n", [1799])
            draw("p", [1990])
            draw("d", [1991])
            draw("i", [2038])
            flip()
        })
    }
    requestAnimationFrame(init)
})

let i = 0
const start = () => {
    ani.value = window.setInterval(() => {
        requestAnimationFrame(frames[++i % 10])
    }, 125)
}
const stop = () => ani.value && clearInterval(ani.value)
onBeforeUnmount(stop)
</script>
<template>
    <canvas
        @mouseenter="start"
        @mouseleave="stop"
        width="48"
        height="48"
        ref="canvasRef"
    ></canvas>
</template>
<style scoped>
canvas {
    position: absolute;
    inset: 0;
    margin: auto;
    width: 66%;
    aspect-ratio: 1/1;
    image-rendering: pixelated;
}
</style>
